// ⠀⠀⠀⠀⠀⣠⣤⣤⣤⣤⣤⣤⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⢀⣼⡿⠉⠉⠉⠉⠉⠉⠹⠿⠶⣶⣤⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⢠⣾⡿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠛⢿⣷⣄⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⣴⣾⡿⠟⣿⡏⠀⠀⠀⠀⠀⠀⠀
// ⠀⢀⣼⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⢿⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣴⡿⠟⠛⠛⠁⠀⠀⢹⣿⣀⠀⠀⠀⠀⠀⠀
// ⠀⣾⡿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⣇⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⡿⠏⠀⠀⠀⠀⠀⠀⠀⠈⣻⣧⡀⠀⠀⠀⠀⠀
// ⣤⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠹⠿⠀⠀⠀⠀⠀⠀⠀⠀⣀⣀⠀⠀⠀⠀⠀⠀⠀⣾⡿⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⣿⠀⠀⠀⠀⠀⠀
// ⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣶⣾⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⡆⠀⠀⠀⠀⠀
// ⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢺⣿⠋⠀⠸⠿⣥⣤⣤⣤⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠾⣷⠄⠀⠀⠀⠀
// ⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠀⠀⠀⠀⠀⠙⠛⠋⠻⢿⣷⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⠀⠀⠀⠀⠀
// ⢸⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠛⣿⡆⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣿⡄⠀⠀⠀⠀
// ⣼⣧⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣴⣤⣶⣿⠿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣻⡇⠀⠀⠀⠀⠀
// ⠀⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠛⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢰⣿⠇⠀⠀⠀⠀⠀
// ⠀⣿⣦⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣰⣾⠗⠀⠀⠀⠀⠀⠀
// ⠀⠀⣿⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣀⣀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣿⣯⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠹⣿⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣠⣴⣿⠿⠟⠛⠛⠻⢿⣧⢀⠀⠀⠀⠀⠀⣀⣤⣤⣾⠿⠿⠿⠿⣷⣤⣄⠀⠀⠀⠀⠀⠀⠀⢀⣾⡟⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠹⣿⣦⠀⠀⠀⠀⠀⠀⠀⠀⣴⣾⠟⠛⠁⠀⠀⠀⠀⠀⠈⠛⢿⡶⠀⠀⠀⣾⣿⡟⠁⠈⠀⠀⠀⠀⠉⠙⣿⣧⠀⠀⠀⠀⠀⢠⣾⡿⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠘⠿⣿⣦⣤⣤⠀⠀⢀⣾⡿⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠛⠃⠀⠀⠀⠀⠀⠀⠀⠀⠉⣿⠀⠀⠀⠀⠰⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⢀⣀⣀⣀⣿⣿⣉⠀⠀⢸⣿⠁⠀⠀⠀⠀⠀⠀⠀⣴⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⢀⣼⣿⡗⠀⠀⠀⠀⠰⠿⠀⠀⠀⢀⣀⣀⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⣿⣿⠛⠛⠛⠛⠻⠃⠀⠻⠋⠀⠀⠀⠀⠀⠀⠀⠀⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠰⣿⣿⣿⡇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠛⠛⠻⢷⣦⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠙⣿⣶⣄⠀⠀⠀⠀⠀⣀⣀⣀⣀⠀⠀⠀⠀⠀⠀⠻⠛⠛⠃⠀⠀⠀⢀⣀⣀⣀⣀⣿⣿⣿⠏⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣾⡿⠟⠁⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⢠⣶⣿⠟⠀⠀⢰⣶⣿⡿⣲⣾⢿⣥⣤⣤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⠿⠿⠿⠿⠟⠀⠉⠀⠀⠀⠀⠀⠀⢠⣾⣖⢶⡦⣤⣤⠘⠿⣿⣦⣄⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠸⠿⣶⡆⠀⠀⠀⠉⠁⠀⢻⡿⠿⠛⠛⠛⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⠀⠀⢀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠛⢾⣯⠿⠟⠋⠀⠀⣬⣽⣿⠗⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠉⠁⠀⠀⢀⣤⣤⣄⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣶⡶⡿⠛⠛⣿⣶⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⣠⣀⣀⣀⠀⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢿⣿⡛⠻⠟⠻⠿⠂⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⠋⠀⠀⠀⠀⠀⠙⠃⠀⠀⠀⠀⠀⠀⠀⢠⣾⠿⣛⣿⡟⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣤⣿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠛⠛⢿⣷⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠿⠿⢿⣾⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⣶⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠀⠀⠀⠀⠀⠀⢠⣤⣤⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⢻⣷⣤⠶⣦⡀⢰⡤⢶⡴⠶⡄⣴⠶⢶⣤⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⣸⠯⣼⠓⣿⡇⢼⡇⢸⡇⠀⡇⢸⠀⢸⣿⢀⣤⠀⠀⠀⠀⠀⣀⠀⢀⡀⠀⠀⠀⠀⢠⣠⢠⡀⠀⠀⠀
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠛⠛⠉⠀⠉⠛⠋⠃⠘⠁⠘⠃⠈⠃⠙⠀⠈⠛⠘⠋⠀⠀⠀⢠⣴⣷⣶⣾⣿⣶⣮⣷⣼⣾⣿⣿⣾⣿⣿⣿
// ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⠛⠛⠛⠉⠛⠛⠙⠛⠙⠙⠙⠙⠉⠙⠙⠋
import { APP_VERSION } from "./smule"

/**
 * This file is required in order for the performance processing stage
 * to finish. There are two types of it:
 * 
 * - JSON -> self explanatory, its a json file
 * - FBS -> using google's flatbuffers
 * 
 * The FBS file _may_ have more data than the JSON one, but even then,
 * it's mostly for analytical / tracking purposes more than anything else
 * 
 * Or at least, i havent noticed a difference on my machine :3
 */
export namespace SmuleAudio {
    /**
     * This couldve been a class, but i wrote it before i realised
     * i only need the JSON-based file, not the whole meta file
     */
    export type MetadataJSON = {
        alyce: ALYCEМetadata,
        audioPower: AudioPower,
        audioPowerEvents: Array<AudioPowerEvent>,
        audioTemplateId: number,
        audio_template_parameters: { [key: string]: number },
        autoTuneEnabled?: boolean,
        avComposition: AVComposition,
        avgNoiseRMS: number,
        avgRMS: number,
        avgUnvoicedRMS: number,
        clientLatencyEstimate: number,
        clientVersion: string,
        crossTalkReductionApplied: boolean,
        crossTalkReductionEnabled: boolean,
        deviceData: DeviceData,
        faceLocations: Array<FaceValues>,
        glitchCount: GlitchCount,
        hasAudioVisualizer: boolean,
        hasSnapLens: boolean,
        headthing: string,
        maxNoiseRMS: number,
        maxRMS: number,
        maxUnvoicedRMS: number,
        maxVoicedRMS: number,
        medianNoiseRMS: number,
        medianRMS: number,
        medianUnvoicedRMS: number,
        medianVoicedRMS: number,
        minNoiseRMS: number,
        minRMS: number,
        minUnvoicedRMS: number,
        minVoicedRMS: number,
        noiseGateThreshold: number,
        noiseGateThresholds: { [key: string]: any },
        noiseProfile: string,
        normalizationScaleFactor: number,
        performanceSegment: PerformanceSegment,
        preGain: number,
        renderPassThroughAsDry: boolean,
        renderedSeedVersion: string,
        rnnoiseApplied: boolean,
        rnnoiseDeterminationComplete: boolean,
        rnnoiseEnabled: boolean,
        rtmUsage: string,
        settings: SettingsMetadata,
        sibilanceFrequencyHz: number,
        snr: number,
        templateId: number,
        template_parameters: { [key: string]: number },
        usePreGain: boolean,
        userDelayCalibrationMs: number,
        vFactor: number,
        vScore: number,
        visualGainDb: number,
        vocalMonitorVersion: number,
        voicedRMS: number
    }
    export type ALYCEМetadata = {
        color: string,
        particles: {
            [key: string]: {
                user_intensity_factor: number
            }
        },
        style: string
    }
    export type AudioPower = {
        bufferSize: number,
        durationInSecs: number,
        data: string, // base64
        sampleRate: number
    }
    export type AudioPowerEvent = {
        isOn: boolean,
        offset: number
    }
    export type AVComposition = {
        content: {
            [key: string]: Object
        },
        end: number,
        start: number
    }
    export type DeviceData = {
        CPU_Architecture: string,
        CPU_Features: string[],
        CPU_Name?: string,
        audioChipset?: string,
        clockSpeed: number,
        maxMemory: number,
        numberOfCores: number
    }
    export type FaceValues = {
        height: number,
        time: number,
        valid_face: boolean,
        width: number,
        x: number,
        y: number,
    }
    export type GlitchCount = {
        fileGlitches: number,
        inputCalls: number,
        inputGlitchFrames: number[],
        inputGlitches: number,
        inputUnderruns: number,
        ioWarmup: number,
        outputCalls: number,
        outputGlitchFrames: number[],
        outputGlitches: number,
        playbackGlitches: number
    }
    export type PerformanceSegment = {
        end: number,
        fadeIn: number,
        fadeOut: number,
        id?: number,
        leadInDuration: number,
        leadOutDuration: number,
        start: number,
        leadInStart: number,
        shortSeed: boolean,
    }
    export type SettingsMetadata = {
        afxAlternates: { [key: string]: number },
        pregainParams: { [key: string]: number },
    }

    /**
     * Creates a dummy MetadataJSON object
     */
    export function createMetadataJSON(): MetadataJSON {
        return {
            voicedRMS: 0,
            minRMS: 0,
            maxRMS: 0,
            sibilanceFrequencyHz: 0,
            noiseProfile: "",
            visualGainDb: 0,
            normalizationScaleFactor: 1,
            maxNoiseRMS: 0,
            usePreGain: false,
            clientLatencyEstimate: -1,
            crossTalkReductionEnabled: false,
            crossTalkReductionApplied: false,
            clientVersion: APP_VERSION,
            deviceData: null,
            noiseGateThreshold: 0,
            preGain: 0,
            vocalMonitorVersion: 0,
            vScore: 0,
            vFactor: 0,
            avgRMS: 0,
            medianRMS: 0,
            minNoiseRMS: 0,
            avgNoiseRMS: 0,
            medianNoiseRMS: 0,
            minVoicedRMS: 0,
            maxVoicedRMS: 0,
            medianVoicedRMS: 0,
            minUnvoicedRMS: 0,
            maxUnvoicedRMS: 0,
            avgUnvoicedRMS: 0,
            medianUnvoicedRMS: 0,
            renderedSeedVersion: "0",
            hasAudioVisualizer: false,
            autoTuneEnabled: null,
            rtmUsage: "",
            headthing: "none",
            rnnoiseApplied: false,
            rnnoiseEnabled: false,
            rnnoiseDeterminationComplete: false,
            snr: null,
            renderPassThroughAsDry: true,
            // this is stolen from my phone lol
            audioPower: {
                data: "ICsyNwXmCTizQ4g4lE+POI6KjjgySZE40OqKOKk+lTifuY04BD+KONIeiTjM2JI4+AqMOPeKoDhMhp04OqiROLxJiThYg484WIOPOL+YjzilPYs4de2QOOBfkDis2Yg4vzGQOCh8jTiSV5I4cSmOOIWQiTi6hpM4jgOQOOWhjjgNitQ6xBgBOvc/ZjkALjI6S8a1OK5Pijhcy5E4elh9OMzolDhP/M84QXc7OmByqzjjX6A4vWiQOMJuhziEkog4qo2TOMjHijjG8Y84AKanOPdiMTl0J/A4tUIVOgounTsz7R48bUswPJp7FjyyM4A7P51KOlIJfjlSUpI4r92YOHcWgzhJtpE4LzyIOD2YkjjrdI04AGqBOAY9mTjMDIw4WkyLOJiBjDi7AZQ44c2JOFr9kDg3h4k4ps2QOPeonjkFe/o5sQC5OEnKmjhZM4k4yIqLOFW1ijj00pA4crqLONVvkDgoT5M4SZuLOPjPjzjBqss5Ek2SOGiYkThrp4c4FyeQOCVfhTgW7a84YryPOGeQijiZxYc4xAOIOPXClDhi0pE4lsSJOMR2xTjke087Z8oWOxk/IDzccTk9cvs7OqyRnTjL0oc47emQOFUFkDi38IU4XOqNOBiMkThJHL44cTs4ORgo2znCdxU6GMmiOa0u6TiKI5A4TOmMOMt4kjgyOIQ4JQyJOD7diziBcY8438CJOMzYkjiX94g4g4WFOGmoiji/7ow4RfiUONKIjTjZyI84xvGGOIIDkjgy/Yg47dycOD4rjji6RJM48Y+OODMxjzh1SY04hJ6NOEzpjDgSfIo4KOGIOKwEiThXM5M4FK2HONqLlDh2iJM47y6LODCtgThF4ZU4A/aMOAMOiTg2ao44qgqQOAi5gTiSUJI40gOGOLacjTixZYk4oPKFOPtwijhC0os4q72MOD0NkTgP1Ig4DgiPOEqmiziSg4Y4h9COOCzHhDhaupQ4kz2HOLRxkTgR/4g4m8OLOJ0yizh+04w4mHaLOBwYijjwEIg4cgaLODSahzhZLoo4eCaPOHXEjTiuJI84ZbaMOLVEhjhYmpA4732LOJCBjzhGH4c4eD+HOOWNozgfs5A4P46NOAtIjjgCfpA44OeJOBU3iTjWB5M4yWCMOC78hTiXzJI4vdKEOIgIljgx2YM4AlKROKJcijgZj4U4q72MOFmsjziF54c4ni+JOJJEijgwBZQ4HpKLOHLnkTgWcYs41MGHOJE0kjh3V4U4iV91OInM1TgVMI04Nw+POAJsjjjG8Y84pAeGOINaiTgbF5A4lsSJOGuJhDi585E4tveKOMIukTi6wY84JImIOEs1kDgVN4k4kV6SOIFxjzjjkIY492GJOITqlDjMWIM4fb+MOKVGjzisBIk4tu2SOHR91Tht7pg4jDSBOA4elTiB6og49l6MONQBjDhOno44MzCKOIKcjjjXVYw4u0ylOBf+hThqwIY4EqmOOKgrfzgCUpE40WSOOEcKiTiOHoY4hJ6NOMIfjThEBo84/LeIOLe6hjj3pJA4AwmOOKVHjTibA444OOiLOLXskTjCcIg4s9eOOHSXjDhwII445CKPODMljThqKYs4o++EOJh2izi59Yg4HWgnOVfayzhvVo44SLqHOIVIhjih6wM502uAOAWRlDj/5JI4vEmJOKSxijjt2404dJeMOHXEjTj47JM44oiMOGefiTgy/o04/UKTOId2ijhEoYk4MMKOOPRUlTjcL5M4olSOOMtekzi27Ys4PVOVOE3nfTnDq947ajvNO0dQtzw+rgw9OOJWPfaSijz7PoU54BSNOHX9ljhw7I84QqqKOPgWnDgTA7s6Q7jUPPsYMTzTdhg8IFqVO6ufaTqTepM4uRyTOPN9jDg/HYw4d0dVOKDpzTcNVX42",
                bufferSize: 2048,
                durationInSecs: 0,
                sampleRate: 48000
            },
            userDelayCalibrationMs: 0,
            audioPowerEvents: [],
            alyce: null,
            audioTemplateId: 0,
            audio_template_parameters: {},
            avComposition: null,
            faceLocations: null,
            glitchCount: {
                fileGlitches: 0,
                inputCalls: 0,
                inputGlitchFrames: [],
                inputGlitches: 0,
                inputUnderruns: 0,
                ioWarmup: 0,
                outputCalls: 0,
                outputGlitchFrames: [],
                outputGlitches: 0,
                playbackGlitches: 0
            },
            hasSnapLens: null,
            noiseGateThresholds: {
                thresholds: [],
                windowSampleRateHz: 0,
                windowDurationS: 0  
            },
            performanceSegment: null,
            settings: null,
            templateId: 0,
            template_parameters: null
        }
    }
}